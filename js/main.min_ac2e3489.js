var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},__assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;n>r;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{l(n.next(e))}catch(t){o(t)}}function s(e){try{l(n["throw"](e))}catch(t){o(t)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(a=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(n){r=[6,n],o=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Store=function(){function e(){this.state={}}return e.prototype.getState=function(e){return e?this.state[e]:this.state},e.prototype.setState=function(e,t){this.state[e]=t},e}();__reflect(Store.prototype,"Store");var AppStore=new Store,AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,r){function n(n){t.call(r,n,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?n(i):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Hoodle=function(e){function t(t){var r=e.call(this)||this;return r.iSpeedX=5,r.iSpeedY=5,r.s=5,r.init=function(){var e=r._option;r.graphics.beginFill(0,1),r.graphics.drawCircle(21.5,21.5,e.radius),r.x=e.x,r.y=e.y,r.graphics.endFill()},r.start=function(e,t){console.log(1),r.iSpeedX=e,r.iSpeedY=t,egret.startTick(r.run,r)},r.run=function(){var e=r._option;r.iSpeedY+=r.s;for(var t=r.iSpeedX+r.x,n=r.iSpeedY+r.y,i=100,o=1/i;1>o;){var a=r.iSpeedX*o+r.x,s=r.iSpeedY*o+r.y,l=r.hitTest(s,a);if(l){switch(console.log(l),l.type){case"bottom":r.iSpeedY*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,n=l.amend;break;case"right":r.iSpeedX*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,t=l.amend;break;case"top":r.iSpeedY*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,n=l.amend;break;case"left":r.iSpeedX*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,t=l.amend}break}if(e.container.width-a-r.width<=0){r.iSpeedX*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,t=e.container.width-r.width;break}if(e.container.height-s-r.height<=0){r.iSpeedY*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,n=e.container.height-r.height;break}if(r.x+a<0){r.iSpeedX*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,t=0;break}if(r.y+s<0){r.iSpeedY*=-1,r.iSpeedX*=.9,r.iSpeedY*=.9,n=0;break}o+=1/i}return r.y=n,r.x=t,Math.abs(r.iSpeedX)<1&&(r.iSpeedX=0),Math.abs(r.iSpeedY)<1&&(r.iSpeedY=0),n===e.container.height-r.height&&0===r.iSpeedY&&0===r.iSpeedX&&(egret.stopTick(r.run,r),console.log("1")),!0},r.stop=function(){egret.stopTick(r.run,r)},r.hitTest=function(e,t){for(var n=AppStore.getState("currentObs"),i=0,o=Object.keys(n);i<o.length;i++)for(var a=o[i],s=0,l=Object.keys(n[a]);s<l.length;s++){var u=l[s],c=n[a][u];if(c){var p=c.instance,h=c.topCanHit,d=c.bottomCanHit,f=c.leftCanHit,g=c.rightCanHit,m=t+r.width,b=t,S=e+r.height,y=e,_=p.x+p.width,v=p.x,w=p.y+p.height,N=p.y;if(d&&r.iSpeedY<0&&m>v&&_>b&&w>y&&S>w){var C=Number(p.getChildAt(0).text);return C>1?(p.getChildAt(0).text=C-1,p.text=C-1):(p.parent.removeChild(p),n[a][u]=null,n[Number(a)+1]&&n[Number(a)+1][u]&&(n[Number(a)+1][u].topCanHit=!0),0!==Number(a)&&n[Number(a)-1][u]&&(n[Number(a)-1][u].bottomCanHit=!0),n[a][Number(u)+1]&&(n[a][Number(u)+1].leftCanHit=!0),0!==Number(u)&&n[a][Number(u)-1]&&(n[a][Number(u)-1].rightCanHit=!0)),{type:"bottom",amend:w}}if(g&&r.iSpeedX<0&&S>N&&w>y&&_>b&&m>_){var C=Number(p.getChildAt(0).text);return C>1?(p.getChildAt(0).text=C-1,p.text=C-1):(p.parent.removeChild(p),n[a][u]=null,n[Number(a)+1]&&n[Number(a)+1][u]&&(n[Number(a)+1][u].topCanHit=!0),0!==Number(a)&&n[Number(a)-1][u]&&(n[Number(a)-1][u].bottomCanHit=!0),n[a][Number(u)+1]&&(n[a][Number(u)+1].leftCanHit=!0),0!==Number(u)&&n[a][Number(u)-1]&&(n[a][Number(u)-1].rightCanHit=!0)),{type:"right",amend:_}}if(h&&r.iSpeedY>0&&m>v&&_>b&&S>N&&N>y){var C=Number(p.getChildAt(0).text);return C>1?(p.getChildAt(0).text=C-1,p.text=C-1):(p.parent.removeChild(p),n[a][u]=null,n[Number(a)+1]&&n[Number(a)+1][u]&&(n[Number(a)+1][u].topCanHit=!0),0!==Number(a)&&n[Number(a)-1][u]&&(n[Number(a)-1][u].bottomCanHit=!0),n[a][Number(u)+1]&&(n[a][Number(u)+1].leftCanHit=!0),0!==Number(u)&&n[a][Number(u)-1]&&(n[a][Number(u)-1].rightCanHit=!0)),{type:"top",amend:N-r.height}}if(f&&r.iSpeedX>0&&S>N&&w>y&&m>v&&v>b){var C=Number(p.getChildAt(0).text);return C>1?(p.getChildAt(0).text=C-1,p.text=C-1):(p.parent.removeChild(p),n[a][u]=null,n[Number(a)+1]&&n[Number(a)+1][u]&&(n[Number(a)+1][u].topCanHit=!0),0!==Number(a)&&n[Number(a)-1][u]&&(n[Number(a)-1][u].bottomCanHit=!0),n[a][Number(u)+1]&&(n[a][Number(u)+1].leftCanHit=!0),0!==Number(u)&&n[a][Number(u)-1]&&(n[a][Number(u)-1].rightCanHit=!0)),{type:"left",amend:v-r.width}}}}},r._option=__assign({x:0,y:0,radius:20,container:r.parent},t),r.init(),r}return __extends(t,e),t}(egret.Shape);__reflect(Hoodle.prototype,"Hoodle");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var obstaclesAll=[[3,0,0,0,0,0,0],[3,2,3,3,3,3,0],[0,0,0,0,0,0,0],[0,2,3,3,3,3,3]],Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hoodle=null,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.loadResource()];case 1:return r.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=r.sent(),[4,platform.login()];case 3:return r.sent(),[4,platform.getUserInfo()];case 4:return t=r.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),console.log(AppStore),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return r.sent(),this.stage.removeChild(e),[3,5];case 4:return t=r.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,r){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=this.createBitmapByName("bg_jpg");this.addChild(e);var t=this.stage.stageWidth,r=this.stage.stageHeight;e.width=t,e.height=r,AppStore.setState("hoodles",[new Hoodle({x:(this.stage.stageWidth-20)/2,y:this.stage.stageHeight-200,radius:20,container:this})]),this.renderHoodle(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hoodleStart,this),this.renderObstacle()},t.prototype.renderObstacle=function(){for(var e=0,t=0,r=0,n=0,i=[],o=0,a=obstaclesAll;o<a.length;o++){var s=a[o],l=[];0===e&&(r=s.length,n=this.stage.stageWidth/r);for(var u=0,c=s;u<c.length;u++){var p=c[u];if(p){var h=new egret.Sprite;h.graphics.lineStyle(2,14423100),h.graphics.beginFill(9662683,1),h.graphics.drawRect(0,0,n,n),h.graphics.endFill();var d=new egret.TextField;d.text=""+p,d.size=36,d.width=n,d.height=n,d.textAlign=egret.HorizontalAlign.CENTER,d.verticalAlign=egret.VerticalAlign.MIDDLE,d.fontFamily="Impact",h.addChild(d),h.x=t*n,h.y=e*n,this.addChild(h);var f=0!==e&&!obstaclesAll[e-1][t],g=0!==t&&!s[t-1],m=e===obstaclesAll.length-1||!obstaclesAll[e+1][t],b=t!==s.length-1&&!s[t+1];l.push({value:p,instance:h,topCanHit:f,leftCanHit:g,bottomCanHit:m,rightCanHit:b}),t++}else t++,l.push(null)}e++,t=0,i.push(l)}AppStore.setState("currentObs",i)},t.prototype.renderHoodle=function(){for(var e=AppStore.getState("hoodles"),t=0,r=e;t<r.length;t++){var n=r[t];this.addChild(n)}},t.prototype.hoodleStart=function(){for(var e=AppStore.getState("hoodles"),t=0,r=e;t<r.length;t++){var n=r[t];n.start(-50,-100)}},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,r=RES.getRes(e);return t.texture=r,t},t.prototype.startAnimation=function(e){var t=this,r=new egret.HtmlTextParser,n=e.map(function(e){return r.parse(e)}),i=this.textfield,o=-1,a=function(){o++,o>=n.length&&(o=0);var e=n[o];i.textFlow=e;var r=egret.Tween.get(i);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(a,t)};a()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,r,n){function i(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),r.call(n))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,r){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(n,generateJSON.paths[e])},this):RES.getResByUrl(l,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){t.call(n,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);